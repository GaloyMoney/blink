load("@toolchains//workspace-pnpm:macros.bzl", "build_node_modules", "tsc_build")

export_file(
  name = "package.json",
  visibility = ["PUBLIC"],
)

build_node_modules(
  name = "node_modules",
)

filegroup(
    name = "src",
    srcs = glob([
        "src/**",
        "tsconfig.json",
        "tsconfig-build.json",
    ]),
)

tsc_build(
  name = "api",
  tsconfig = "tsconfig-build.json",
  srcs = [":src"],
)

# // install deps
# // ^^ simple toolchain
# // compile via tsc
# // ^^ tsc_bin
# // ^^ tsc_compile
# // run via node
# // ^^ exec via pnpm toolchain?

# npm_bin(
#   name = "api"
# )
