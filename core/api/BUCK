load(
  "@toolchains//workspace-pnpm:macros.bzl",
  "dev_pnpm_task_binary",
  "dev_pnpm_task_test",
  "build_node_modules",
  "tsc_build",
  "prod_tsc_build",
  "prod_tsc_build_bin",
  "audit",
  "eslint",
  "typescript_check",
  "yaml_check",
  "madge_check",
  "jest_test",
)
load("@toolchains//rover:macros.bzl", "sdl", "diff_check", "dev_update_file")

dev_pnpm_task_binary(
  name = "fix-lint",
  command = "eslint-fix",
)

export_file(
  name = "package.json",
  visibility = ["PUBLIC"],
)

build_node_modules(
  name = "node_modules",
)

build_node_modules(
  name = "node_modules_prod",
  prod_only = True,
)

filegroup(
    name = "src",
    srcs = glob([
        "src/**",
        "tsconfig.json",
        "tsconfig-build.json",
    ]),
)

filegroup(
    name = "test_src",
    srcs = glob([
        "test/**",
    ]),
)

filegroup(
  name = "locales",
  srcs = glob([
    "src/config/locales/*.json"
  ])
)

filegroup(
  name = "protos",
  srcs = glob([
    "src/services/**/protos/**",
    "src/services/**/proto/**"
  ])
)

prod_deps_srcs = {
  "lib/gt3-server-node-express-sdk": "//lib/gt3-server-node-express-sdk:src",
}

tsc_build(
  name = "build",
  tsconfig = "tsconfig-build.json",
  srcs = [":src"],
  additional_dist_files = [":protos", ":locales"],
  prod_deps_srcs = prod_deps_srcs,
)

prod_tsc_build(
  name = "prod_build",
  prod_deps_srcs = prod_deps_srcs,
  visibility = ["PUBLIC"],
)

prod_tsc_build_bin(
  name = "api",
  preload_file = "services/tracing.js",
  run_file = "servers/graphql-main-server.js",
)

prod_tsc_build_bin(
  name = "write-sdl",
  run_file = "servers/write-sdl.js",
)

sdl(
  name = "public-sdl",
  generator = ":write-sdl",
  args = ["public"],
  visibility = ["PUBLIC"],
)

diff_check(
  name = "public-schema-diff",
  original = "src/graphql/public/schema.graphql",
  new = ":public-sdl"
)

dev_update_file(
  name = "update-public-schema",
  generated = ":public-sdl",
  out = "src/graphql/public/schema.graphql"
)

sdl(
  name = "admin-sdl",
  generator = ":write-sdl",
  args = ["admin"]
)

diff_check(
  name = "admin-schema-diff",
  original = "src/graphql/admin/schema.graphql",
  new = ":admin-sdl"
)

dev_update_file(
  name = "update-admin-schema",
  generated = ":admin-sdl",
  out = "src/graphql/admin/schema.graphql"
)

audit(
    name = "audit",
    level = "critical",
)

eslint(
    name = "check-lint",
    srcs = [":src"] + [":test_src"] + glob([".eslint*"]),
    extensions = [".ts"],
    allow_warnings = True,
)

dev_pnpm_task_test(
  name = "dev-check-lint",
  command = "eslint-check",
)

typescript_check(
    name = "check-type",
    srcs = [":src"] + [":test_src"],
)

dev_pnpm_task_test(
  name = "dev-check-type",
  command = "tsc-check",
)

yaml_check(
    name = "check-yaml",
    srcs = glob([
        ".prettier*",
        "prettier*",
        "*.yml",
        "*.yaml",
    ]),
)

madge_check(
    name = "check-circular-dependencies",
    srcs = [":src"],
)

dev_pnpm_task_test(
  name = "dev-check-circular-dependencies",
  command = "circular-deps-check",
)

jest_test(
    name = "unit-tests",
    srcs = [":src"] + [":test_src"] + glob(["galoy.yaml"]),
    config_file = "test/unit/jest.config.js",
    app_env = {
        "HELMREVISION": "dummy",
        "KRATOS_PG_CON": "pg://dummy",
        "OATHKEEPER_DECISION_ENDPOINT": "http://dummy",
        "NETWORK": "regtest",
        "TWILIO_ACCOUNT_SID": "dummy",
        "TWILIO_AUTH_TOKEN": "dummy",
        "TWILIO_VERIFY_SERVICE_ID": "dummy",
        "KRATOS_PUBLIC_API": "http://dummy",
        "KRATOS_ADMIN_API": "http://dummy",
        "KRATOS_MASTER_USER_PASSWORD": "dummy",
        "BRIA_HOST": "dummy",
        "BRIA_API_KEY": "dummy",
        "NOTIFICATIONS_HOST": "dummy",
        "MONGODB_CON": "mongodb://dummy",
        "REDIS_MASTER_NAME": "dummy",
        "REDIS_PASSWORD": "dummy",
        "REDIS_0_DNS": "dummy",
    },
    env = {
        "LOGLEVEL": "warn",
    }
)

jest_test(
    name = "test-integration",
    srcs = [":src"] + [":test_src"] + glob(["galoy.yaml"]),
    prod_deps_srcs = prod_deps_srcs,
    config_file = "test/integration/jest.config.js",
    run_serially = True,
    app_env = {
        "HELMREVISION": "dev",
        "NETWORK": "regtest",
        "OATHKEEPER_DECISION_ENDPOINT": "http://localhost:4456",
        "TWILIO_ACCOUNT_SID": "AC_twilio_id",
        "TWILIO_AUTH_TOKEN": "AC_twilio_auth_token",
        "TWILIO_VERIFY_SERVICE_ID": "VA_twilio_service",
        "KRATOS_PG_CON": "postgres://dbuser:secret@localhost:5432/default?sslmode=disable",
        "KRATOS_PUBLIC_API": "http://localhost:4433",
        "KRATOS_ADMIN_API": "http://localhost:4434",
        "KRATOS_MASTER_USER_PASSWORD": "passwordHardtoFindWithNumber123",
        "PRICE_HOST": "localhost",
        "PRICE_HISTORY_HOST": "localhost",
        "BRIA_HOST": "localhost",
        "BRIA_API_KEY": "bria_dev_000000000000000000000",
        "NOTIFICATIONS_HOST": "localhost",
        "MONGODB_CON": "mongodb://localhost:27017/galoy",
        "REDIS_MASTER_NAME": "mymaster",
        "REDIS_PASSWORD": "",
        "REDIS_0_DNS": "localhost",
        "REDIS_0_PORT": "6379",
        "REDIS_TYPE": "standalone",
        "UNSECURE_IP_FROM_REQUEST_OBJECT": "true",
        "UNSECURE_DEFAULT_LOGIN_CODE": "000000",
        "GEETEST_ID": "geetest_id",
        "GEETEST_KEY": "geetest_key",

        "SVIX_SECRET": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE2OTE2NzIwMTQsImV4cCI6MjAwNzAzMjAxNCwibmJmIjoxNjkxNjcyMDE0LCJpc3MiOiJzdml4LXNlcnZlciIsInN1YiI6Im9yZ18yM3JiOFlkR3FNVDBxSXpwZ0d3ZFhmSGlyTXUifQ.b9s0aWSisNdUNki4edabBEToLNSwjC9-AiJQr4J3y4E",
        "SVIX_ENDPOINT": "http://localhost:8071",
        "EXPORTER_PORT": "3003",

        "LND1_TLS": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNZVENDQWdlZ0F3SUJBZ0lSQU9zZzdYWFR4cnVZYlhkeTY2d3RuN1F3Q2dZSUtvWkl6ajBFQXdJd09ERWYKTUIwR0ExVUVDaE1XYkc1a0lHRjFkRzluWlc1bGNtRjBaV1FnWTJWeWRERVZNQk1HQTFVRUF4TU1PRFl4T1RneApNak5tT0Roak1CNFhEVEl6TURFeE9USXdOREUxTTFvWERUTTBNRGN5TVRJd05ERTFNMW93T0RFZk1CMEdBMVVFCkNoTVdiRzVrSUdGMWRHOW5aVzVsY21GMFpXUWdZMlZ5ZERFVk1CTUdBMVVFQXhNTU9EWXhPVGd4TWpObU9EaGoKTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFM1lieUlKWU1Vcm8zZkl0UFFucysxZ2lpTXI5NQpJUXRmclFDQ2JhOWVtcjI4TENmbk1vYy9VQVFwUlg3QVlvVFRneUdiMFBuZGNUODF5ZVgvYTlPa0RLT0I4VENCCjdqQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0V3WURWUjBsQkF3d0NnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC8KQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVL1AxRHpJUkRzTEhHMU10d3NrZE5nZ0lub1Mwd2daWUdBMVVkRVFTQgpqakNCaTRJTU9EWXhPVGd4TWpObU9EaGpnZ2xzYjJOaGJHaHZjM1NDRFd4dVpDMXZkWFJ6YVdSbExUR0NEV3h1ClpDMXZkWFJ6YVdSbExUS0NEV3h1WkMxdmRYUnphV1JsTFRPQ0JHeHVaREdDQkd4dVpES0NCSFZ1YVhpQ0NuVnUKYVhod1lXTnJaWFNDQjJKMVptTnZibTZIQkg4QUFBR0hFQUFBQUFBQUFBQUFBQUFBQUFBQUFBR0hCS3dUQUJBdwpDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWhBSU5DNlJWQ3d6SzFYRnFxeVNLY0Y4QzQ5ZFlSOThjemdLNVdkcmNOCkxYYWlBaUJHYmtWeGhaeHdDaDVLQ1o1Z2M1Q2FsQ0RvaGNxVkdiaHNya0hHTFhpdHN3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=",
        "LND1_MACAROON": "AgEDbG5kAvgBAwoQB1FdhGa9xoewc1LEXmnURRIBMBoWCgdhZGRyZXNzEgRyZWFkEgV3cml0ZRoTCgRpbmZvEgRyZWFkEgV3cml0ZRoXCghpbnZvaWNlcxIEcmVhZBIFd3JpdGUaIQoIbWFjYXJvb24SCGdlbmVyYXRlEgRyZWFkEgV3cml0ZRoWCgdtZXNzYWdlEgRyZWFkEgV3cml0ZRoXCghvZmZjaGFpbhIEcmVhZBIFd3JpdGUaFgoHb25jaGFpbhIEcmVhZBIFd3JpdGUaFAoFcGVlcnMSBHJlYWQSBXdyaXRlGhgKBnNpZ25lchIIZ2VuZXJhdGUSBHJlYWQAAAYgqHDdwGCqx0aQL1/Z3uUfzCpeBhfapGf9s/AZPOVwf6s=",
        "LND1_PUBKEY":"03ca1907342d5d37744cb7038375e1867c24a87564c293157c95b2a9d38dcfb4c2",
        "LND1_DNS": "localhost",
        "LND1_RPCPORT": "10009",
        "LND1_NAME": "lnd1",
        "LND1_TYPE": "offchain,onchain",

        "LND2_TLS": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNZVENDQWdlZ0F3SUJBZ0lSQU9zZzdYWFR4cnVZYlhkeTY2d3RuN1F3Q2dZSUtvWkl6ajBFQXdJd09ERWYKTUIwR0ExVUVDaE1XYkc1a0lHRjFkRzluWlc1bGNtRjBaV1FnWTJWeWRERVZNQk1HQTFVRUF4TU1PRFl4T1RneApNak5tT0Roak1CNFhEVEl6TURFeE9USXdOREUxTTFvWERUTTBNRGN5TVRJd05ERTFNMW93T0RFZk1CMEdBMVVFCkNoTVdiRzVrSUdGMWRHOW5aVzVsY21GMFpXUWdZMlZ5ZERFVk1CTUdBMVVFQXhNTU9EWXhPVGd4TWpObU9EaGoKTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFM1lieUlKWU1Vcm8zZkl0UFFucysxZ2lpTXI5NQpJUXRmclFDQ2JhOWVtcjI4TENmbk1vYy9VQVFwUlg3QVlvVFRneUdiMFBuZGNUODF5ZVgvYTlPa0RLT0I4VENCCjdqQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0V3WURWUjBsQkF3d0NnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC8KQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVL1AxRHpJUkRzTEhHMU10d3NrZE5nZ0lub1Mwd2daWUdBMVVkRVFTQgpqakNCaTRJTU9EWXhPVGd4TWpObU9EaGpnZ2xzYjJOaGJHaHZjM1NDRFd4dVpDMXZkWFJ6YVdSbExUR0NEV3h1ClpDMXZkWFJ6YVdSbExUS0NEV3h1WkMxdmRYUnphV1JsTFRPQ0JHeHVaREdDQkd4dVpES0NCSFZ1YVhpQ0NuVnUKYVhod1lXTnJaWFNDQjJKMVptTnZibTZIQkg4QUFBR0hFQUFBQUFBQUFBQUFBQUFBQUFBQUFBR0hCS3dUQUJBdwpDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWhBSU5DNlJWQ3d6SzFYRnFxeVNLY0Y4QzQ5ZFlSOThjemdLNVdkcmNOCkxYYWlBaUJHYmtWeGhaeHdDaDVLQ1o1Z2M1Q2FsQ0RvaGNxVkdiaHNya0hHTFhpdHN3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=",
        "LND2_MACAROON": "AgEDbG5kAvgBAwoQX0BxfhQTxLTiqaceBnGnfBIBMBoWCgdhZGRyZXNzEgRyZWFkEgV3cml0ZRoTCgRpbmZvEgRyZWFkEgV3cml0ZRoXCghpbnZvaWNlcxIEcmVhZBIFd3JpdGUaIQoIbWFjYXJvb24SCGdlbmVyYXRlEgRyZWFkEgV3cml0ZRoWCgdtZXNzYWdlEgRyZWFkEgV3cml0ZRoXCghvZmZjaGFpbhIEcmVhZBIFd3JpdGUaFgoHb25jaGFpbhIEcmVhZBIFd3JpdGUaFAoFcGVlcnMSBHJlYWQSBXdyaXRlGhgKBnNpZ25lchIIZ2VuZXJhdGUSBHJlYWQAAAYgMAKlr1HehfBpn2R5RPE2IuY9r/18QBeLZxYgRidpos4=",
        "LND2_PUBKEY": "039341ef13e776dc1611502cf510110d9ac5cdc252141f5997adcfd72cef34c3a7",
        "LND2_DNS": "localhost",
        "LND2_RPCPORT": "10010",
        "LND2_NAME": "lnd2",
        "LND2_TYPE": "offchain",
      
        "BITCOINDADDR": "localhost",
        "BITCOINDPORT": "18443",

        "TLSOUTSIDE1": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNZVENDQWdlZ0F3SUJBZ0lSQU9zZzdYWFR4cnVZYlhkeTY2d3RuN1F3Q2dZSUtvWkl6ajBFQXdJd09ERWYKTUIwR0ExVUVDaE1XYkc1a0lHRjFkRzluWlc1bGNtRjBaV1FnWTJWeWRERVZNQk1HQTFVRUF4TU1PRFl4T1RneApNak5tT0Roak1CNFhEVEl6TURFeE9USXdOREUxTTFvWERUTTBNRGN5TVRJd05ERTFNMW93T0RFZk1CMEdBMVVFCkNoTVdiRzVrSUdGMWRHOW5aVzVsY21GMFpXUWdZMlZ5ZERFVk1CTUdBMVVFQXhNTU9EWXhPVGd4TWpObU9EaGoKTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFM1lieUlKWU1Vcm8zZkl0UFFucysxZ2lpTXI5NQpJUXRmclFDQ2JhOWVtcjI4TENmbk1vYy9VQVFwUlg3QVlvVFRneUdiMFBuZGNUODF5ZVgvYTlPa0RLT0I4VENCCjdqQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0V3WURWUjBsQkF3d0NnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC8KQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVL1AxRHpJUkRzTEhHMU10d3NrZE5nZ0lub1Mwd2daWUdBMVVkRVFTQgpqakNCaTRJTU9EWXhPVGd4TWpObU9EaGpnZ2xzYjJOaGJHaHZjM1NDRFd4dVpDMXZkWFJ6YVdSbExUR0NEV3h1ClpDMXZkWFJ6YVdSbExUS0NEV3h1WkMxdmRYUnphV1JsTFRPQ0JHeHVaREdDQkd4dVpES0NCSFZ1YVhpQ0NuVnUKYVhod1lXTnJaWFNDQjJKMVptTnZibTZIQkg4QUFBR0hFQUFBQUFBQUFBQUFBQUFBQUFBQUFBR0hCS3dUQUJBdwpDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWhBSU5DNlJWQ3d6SzFYRnFxeVNLY0Y4QzQ5ZFlSOThjemdLNVdkcmNOCkxYYWlBaUJHYmtWeGhaeHdDaDVLQ1o1Z2M1Q2FsQ0RvaGNxVkdiaHNya0hHTFhpdHN3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=",
        "MACAROONOUTSIDE1": "AgEDbG5kAvgBAwoQeE+5exgz7/0ExCn7H6AJlBIBMBoWCgdhZGRyZXNzEgRyZWFkEgV3cml0ZRoTCgRpbmZvEgRyZWFkEgV3cml0ZRoXCghpbnZvaWNlcxIEcmVhZBIFd3JpdGUaIQoIbWFjYXJvb24SCGdlbmVyYXRlEgRyZWFkEgV3cml0ZRoWCgdtZXNzYWdlEgRyZWFkEgV3cml0ZRoXCghvZmZjaGFpbhIEcmVhZBIFd3JpdGUaFgoHb25jaGFpbhIEcmVhZBIFd3JpdGUaFAoFcGVlcnMSBHJlYWQSBXdyaXRlGhgKBnNpZ25lchIIZ2VuZXJhdGUSBHJlYWQAAAYgL7pU+cKOt6zGyWTdWWmAJLP1L3cnbOPb4Rd3QtniyyM=",
        "LNDOUTSIDE1ADDR": "localhost",
        "LNDOUTSIDE1RPCPORT": "10012",
        
        "TLSOUTSIDE2": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNZVENDQWdlZ0F3SUJBZ0lSQU9zZzdYWFR4cnVZYlhkeTY2d3RuN1F3Q2dZSUtvWkl6ajBFQXdJd09ERWYKTUIwR0ExVUVDaE1XYkc1a0lHRjFkRzluWlc1bGNtRjBaV1FnWTJWeWRERVZNQk1HQTFVRUF4TU1PRFl4T1RneApNak5tT0Roak1CNFhEVEl6TURFeE9USXdOREUxTTFvWERUTTBNRGN5TVRJd05ERTFNMW93T0RFZk1CMEdBMVVFCkNoTVdiRzVrSUdGMWRHOW5aVzVsY21GMFpXUWdZMlZ5ZERFVk1CTUdBMVVFQXhNTU9EWXhPVGd4TWpObU9EaGoKTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFM1lieUlKWU1Vcm8zZkl0UFFucysxZ2lpTXI5NQpJUXRmclFDQ2JhOWVtcjI4TENmbk1vYy9VQVFwUlg3QVlvVFRneUdiMFBuZGNUODF5ZVgvYTlPa0RLT0I4VENCCjdqQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0V3WURWUjBsQkF3d0NnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC8KQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVL1AxRHpJUkRzTEhHMU10d3NrZE5nZ0lub1Mwd2daWUdBMVVkRVFTQgpqakNCaTRJTU9EWXhPVGd4TWpObU9EaGpnZ2xzYjJOaGJHaHZjM1NDRFd4dVpDMXZkWFJ6YVdSbExUR0NEV3h1ClpDMXZkWFJ6YVdSbExUS0NEV3h1WkMxdmRYUnphV1JsTFRPQ0JHeHVaREdDQkd4dVpES0NCSFZ1YVhpQ0NuVnUKYVhod1lXTnJaWFNDQjJKMVptTnZibTZIQkg4QUFBR0hFQUFBQUFBQUFBQUFBQUFBQUFBQUFBR0hCS3dUQUJBdwpDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWhBSU5DNlJWQ3d6SzFYRnFxeVNLY0Y4QzQ5ZFlSOThjemdLNVdkcmNOCkxYYWlBaUJHYmtWeGhaeHdDaDVLQ1o1Z2M1Q2FsQ0RvaGNxVkdiaHNya0hHTFhpdHN3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=",
        "MACAROONOUTSIDE2": "AgEDbG5kAvgBAwoQfKO82/iPT2zIwWYPrOXvABIBMBoWCgdhZGRyZXNzEgRyZWFkEgV3cml0ZRoTCgRpbmZvEgRyZWFkEgV3cml0ZRoXCghpbnZvaWNlcxIEcmVhZBIFd3JpdGUaIQoIbWFjYXJvb24SCGdlbmVyYXRlEgRyZWFkEgV3cml0ZRoWCgdtZXNzYWdlEgRyZWFkEgV3cml0ZRoXCghvZmZjaGFpbhIEcmVhZBIFd3JpdGUaFgoHb25jaGFpbhIEcmVhZBIFd3JpdGUaFAoFcGVlcnMSBHJlYWQSBXdyaXRlGhgKBnNpZ25lchIIZ2VuZXJhdGUSBHJlYWQAAAYg2XkV+4Z4inbfXGZivRoY+r7KHNZhgxkCEdKByxbeb/Q=",
        "LNDOUTSIDE2ADDR": "localhost",
        "LNDOUTSIDE2RPCPORT": "10013",
    },
    env = {
        "LOGLEVEL": "warn",
    }
)

test_suite(
    name = "test",
    tests = [
        ":audit",
        ":check-lint",
        ":check-type",
        ":check-yaml",
        ":check-circular-dependencies",
        ":public-schema-diff",
        ":admin-schema-diff",
        ":unit-tests",
    ],
)

test_suite(
    name = "dev-check-code",
    tests = [
        ":dev-check-lint",
        ":dev-check-type",
        ":dev-check-circular-dependencies",
    ],
)

dev_pnpm_task_binary(
  name = "dev",
  command = "dev:api",
  srcs = [":src"],
)

dev_pnpm_task_binary(
  name = "dev-trigger",
  command = "dev:api-trigger",
  srcs = [":src"],
  visibility = ["PUBLIC"],
)

dev_pnpm_task_binary(
  name = "dev-exporter",
  command = "dev:api-exporter",
  srcs = [":src"],
  visibility = ["PUBLIC"],
)

dev_pnpm_task_binary(
  name = "dev-ws-server",
  command = "dev:api-ws-server",
  srcs = [":src"],
  visibility = ["PUBLIC"],
)

dev_pnpm_task_binary(
  name = "dev-cron",
  command = "dev:cron",
  srcs = [":src"],
  visibility = ["PUBLIC"],
  env_file = ".env",
)

dev_pnpm_task_binary(
  name = "watch-compile",
  command = "watch:compile",
  srcs = [":src"] + [":test_src"],
)
