#!/usr/bin/env python3
"""
Downloads and installs packages via Pnpm.
"""
import argparse
import os
import shutil
import subprocess
import sys

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description=__doc__)
    parser.add_argument(
        "--root-dir",
        help="Path to the root",
    )
    parser.add_argument(
        "node_modules_out_path",
        help="Path to output `node_modules`",
    )

    args = parser.parse_args()

    cmd = ["pnpm", "install", "--frozen-lockfile"]

    exit_code = subprocess.call(cmd, cwd=args.root_dir)

    if exit_code == 0:
        src = os.path.join(args.root_dir, "node_modules")

        shutil.copytree(
            src,
            os.path.join(args.node_modules_out_path, "node_modules"),
            symlinks=True,
        )

    sys.exit(exit_code)

