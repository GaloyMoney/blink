
# - id: decline-direct-access-validatejwt
#   upstream: 
#     url: "http://localhost:4002"
#   match: 
#     url: "<(http|https)>://<[a-zA-Z0-9-.:]+>/auth/validatejwt"
#     methods: ["GET", "POST"]
#   authenticators:
#   - handler: unauthorized
#   authorizer:
#     handler: allow
#   mutators: 
#   - handler: noop
- id: galoy-backend
  upstream: 
    url: "http://e2e-tests:4002"
  match: 
    url: "<(http|https)>://<[a-zA-Z0-9-.:]+>/<.*>"
    methods: ["GET", "POST"]
  authenticators:
  - handler: bearer_token
    config: 
      check_session_url: "http://e2e-tests:4002/auth/validatejwt"
      preserve_path: true
      preserve_query: true
  - handler: anonymous
  authorizer:
    handler: allow
  mutators:
  - handler: id_token
    config: 
      claims: '{"uid": "{{ print .Extra.uid }}"}'


#  {
#     "id": "public-kratos",
#     "upstream": {
#       "url": "http://kratos:4433"
#     },
#     "match": {
#       "url": "<(http|https)>://<[a-zA-Z0-9-.:]+>/<(self-service/.*)|sessions/whoami|(.well-known/.*)>",
#       "methods": [
#         "GET",
#         "POST"
#       ]
#     },
#     "authenticators": [
#       {
#         "handler": "anonymous"
#       }
#     ],
#     "authorizer": {
#       "handler": "allow"
#     },
#     "mutators": [
#       {
#         "handler": "noop"
#       }
#     ]
#   }
